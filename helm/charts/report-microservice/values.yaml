# Global namespace override (optional)
# Note: Namespace resources are often managed outside of individual charts.
# Set this if deploying to a specific namespace via this chart.
namespace: ns-retailpulse

# MongoDB Configuration
mongodb:
  enabled: false
  image: mongo:7
  rootUsername: admin
  rootPassword: secret
  database: reportsdb
  webUsername: webuser # For ME_CONFIG_BASICAUTH_USERNAME if needed by web UI
  webPassword: webpass # For ME_CONFIG_BASICAUTH_PASSWORD if needed by web UI
  storage: 5Gi
  # storageClassName: "" # Uncomment/set to your cluster's class if needed, e.g., "standard"

# Report App Configuration
app:
  enabled: true
  image: docker.io/casperyap/rp-report-app:v0.1.0 
  imagePullPolicy: Always
  port: 8086
  nodePort: 30086
  configYaml: |
    server:
      port: 8086

    auth:
      enabled: true
      origin: ORIGIN_URL:ORIGIN_PORT
      jwt:
        key:
          set:
            uri: /IAM_SVC:IAM_PORT/auth/oauth2/jwks

    spring:
      data:
        mongodb:
          uri: "mongodb://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}?ssl=true&replicaSet=rs0&readPreference=secondaryPreferred&retryWrites=false&tlsAllowInvalidHostnames=true"
          database: reportsdb
          
    app:
      gridfs:
        bucket: reports # GridFS bucket name (prefixes fs.files/fs.chunks)
        
    inventory:
      api:
        base-url: "http://INVENTORY_SVC:8084" # Dynamically replaced

    logging:
      level:
        root: "INFO"
        org.springframework.security: "INFO"
        com.retailpulse: "DEBUG"
        com.example.report.infrastructure.feign: "INFO"
        org.springframework.cloud.openfeign: DEBUG
        feign: DEBUG
      file:
        name: "logs/report-service.log"
    
    management:
      tracing:
        enabled: true
        sampling:
          probability: 1.0

dependencies:
  inventoryReleaseName: "retailpulse-inventory" 
  iamReleaseName: "retailpulse-iam" 
  webURL: localhost
  webExternalPort: 30080